name: Pull Oura Data

on:
  schedule:
    - cron: "0 9 * * *" # Runs every day at 9 AM
  workflow_dispatch:
    inputs:
      date:
        description: "Date to pull data for (YYYY-MM-DD)"
        required: false

jobs:
  pull-oura-data:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install dependencies
        run: pip install requests cloudflare-python

      - name: Pull Oura data
        env:
          OURA_TOKEN: ${{ secrets.OURA_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
        run: |
          python data-gather/collect_oura_data.py ${{ github.event.inputs.date || '' }}
